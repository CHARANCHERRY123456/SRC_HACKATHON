<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organisation Management</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
</head>
<body>
  <div class="container p-5">
    <div class="row">
      <div class="col-12">
        <table class="table">
          <thead>
            <tr class="bg-success text-white">
              <th>Venue</th>
              <th>Availability</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Booked By</th>
              <th>Contact No</th>
              <th>Delete</th>
            </tr> 
          </thead>
          <tbody id="organisationTable">
            <!-- Rows will be populated by JavaScript -->
          </tbody>
        </table>
        <h2>add new location with given form</h2>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-12">
        <form id="organisationForm">
          <div class="mb-3">
            <label for="venue" class="form-label">Venue</label>
            <input value="AB1" type="text" class="form-control" id="venue" name="venue" required>
          </div>
          <div class="mb-3">
            <label for="availability" class="form-label">Availability</label>
            <input value="Booked" type="text" class="form-control" id="availability" name="availability" required>
          </div>
          <div class="mb-3">
            <label for="start" class="form-label">Start Time</label>
            <input value="10:30" type="time" class="form-control" id="start" name="start" required>
          </div>
          <div class="mb-3">
            <label for="end" class="form-label">End Time</label>
            <input value="12:45" type="time" class="form-control" id="end" name="end" required>
          </div>
          <div class="mb-3">
            <label for="booked" class="form-label">Booked By</label>
            <input value="demo@123" type="text" class="form-control" id="booked" name="booked" required>
          </div>
          <div class="mb-3">
            <label for="phno" class="form-label">Contact No</label>
            <input value="1234567" type="text" class="form-control" id="phno" name="phno" required>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded',async () => {
      // Fetch existing venues and populate the table
      try {
    const response = await fetch('/getOrganisations');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    const organisations = await response.json();
    const table = document.getElementById('organisationTable');
    organisations.forEach((organisation, index) => {
      const newRow = table.insertRow();
      newRow.setAttribute('data-id', organisation._id);
      newRow.setAttribute('id', `row-${organisation._id}`);
      newRow.setAttribute('class', 'table-info');
      newRow.innerHTML = `
        <td>${organisation.venue}</td>
        <td id="availability${organisation._id}">${organisation.availability}</td>
        <td id="start${organisation._id}">${organisation.start}</td>
        <td id="end${organisation._id}">${organisation.end}</td>
        <td id="booked${organisation._id}">${organisation.booked}</td>
        <td id="phno${organisation._id}">${organisation.phno}</td>
        <td><a class="btn btn-danger" onclick="deleteVenue('${organisation._id}')">Delete</a></td>
      `;
    });
  } catch (error) {
    console.error('Error fetching venues:', error);
  }

      // Handle form submission
      document.getElementById('organisationForm').addEventListener('submit', (event) => {
        event.preventDefault();
        const formData = new FormData(event.target);
        fetch('/addOrganisation', {
          method: 'POST',
          body: JSON.stringify(Object.fromEntries(formData)),
          headers: { 'Content-Type': 'application/json' }
        })
          .then(response => {
            if (response.ok) {
              window.location.reload(); // Reload page to show new data
            } else {
              console.error('Failed to add venue');
            }
          });
      });
    });

    function bookClass(rowId) {
      alert(rowId)
      fetch('/book-class', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rowId })
      })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error('Error booking class:', error));
    }

    function freeClass(rowId) {
      fetch('/free-class', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rowId })
      })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error('Error freeing class:', error));
    }
    async function deleteVenue(id) {
  try {
    const response = await fetch(`/deleteVenue/${id}`, {
      method: 'DELETE'
    });

    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    // Remove the row from the table
    const row = document.querySelector(`tr[data-id='${id}']`);
    if (row) {
      row.remove();
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

  </script>
</body>
</html>
